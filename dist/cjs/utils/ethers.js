"use strict";var __awaiter=this&&this.__awaiter||function(n,e,t,o){return new(t||(t=Promise))(function(r,i){function c(n){try{a(o.next(n))}catch(n){i(n)}}function s(n){try{a(o.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t(function(n){n(e)})).then(c,s)}a((o=o.apply(n,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.proxyWeb3Provider=exports.proxyContract=void 0;const internals_1=require("./internals");function proxyContract(n,e,t){const o=t?Object.assign({onContractTxRequested:internals_1.noop,onContractTxCancelled:internals_1.noop,onContractTxSent:internals_1.noop},t):{onContractTxRequested:internals_1.noop,onContractTxCancelled:internals_1.noop,onContractTxSent:internals_1.noop},{onContractTxRequested:r,onContractTxCancelled:i,onContractTxSent:c}=o,s={},a=n.interface.functions,u={};for(const n of Object.keys(a))u[a[n].name]=n;const d={};for(const e of Object.keys(n))d[e]=n[e];d.functions={};for(const e of Object.keys(n.functions))d.functions[e]=n.functions[e];function l(t,o){let a=s[o];if(!a){let d=n.interface.functions[o];d||(d=n.interface.functions[u[o]]),a=new Proxy(t[o],{apply:(n,s,a)=>__awaiter(this,void 0,void 0,function*(){const s=a.length;let u,l,p;s===d.inputs.length+1&&"object"==typeof a[s-1]&&(u=a[s]),u&&(l=u.outcome,delete u.outcome),r({name:e,method:o,overrides:u,outcome:l});try{p=yield n.bind(t)(...a)}catch(n){throw i({name:e,method:o,overrides:u,outcome:l}),n}return c({hash:p.hash,name:e,method:o,overrides:u,outcome:l}),p})}),s[o]=a}return a}const p=new Proxy(d.functions,{get:(e,t)=>l(n.functions,t)});return new Proxy(d,{get:(e,t)=>"functions"===t?p:n.functions[t]?l(n.functions,t):"_proxiedContract"===t?n:"toJSON"===t?()=>({address:n.address,abi:n.interface.fragments}):e[t]})}function proxySigner(n,e,{onTxRequested:t,onTxCancelled:o,onTxSent:r,onSignatureRequested:i,onSignatureCancelled:c,onSignatureReceived:s}){e=Object.assign({sendTransaction:(n,e,i)=>__awaiter(this,void 0,void 0,function*(){let c;t(i[0]);try{c=yield n.bind(e)(...i)}catch(n){throw o(i[0]),n}return r(c),c}),signMessage:(n,e,t)=>__awaiter(this,void 0,void 0,function*(){let o;i(t[0]);try{o=yield n.bind(e)(...t)}catch(n){throw c(t[0]),n}return s(o),o})},e);const a={};return new Proxy(n,{get:(t,o)=>{const r=e[o];return r?function(e,t){let o=a[e];return o||(o=new Proxy(n[e],t),a[e]=o),o}(o,{apply:r}):t[o]}})}function proxyUncheckedJsonRpcSigner(n,e){return proxySigner(n,{},e)}function proxyJsonRpcSigner(n,e){return proxySigner(n,{connectUnchecked:(n,t,o)=>{return proxyUncheckedJsonRpcSigner(n.bind(t)(...o),e)}},e)}function proxyWeb3Provider(n,e){const t=e?Object.assign({onTxRequested:internals_1.noop,onTxCancelled:internals_1.noop,onTxSent:internals_1.noop,onSignatureRequested:internals_1.noop,onSignatureCancelled:internals_1.noop,onSignatureReceived:internals_1.noop},e):{onTxRequested:internals_1.noop,onTxCancelled:internals_1.noop,onTxSent:internals_1.noop,onSignatureRequested:internals_1.noop,onSignatureCancelled:internals_1.noop,onSignatureReceived:internals_1.noop},o=new Proxy(n.getSigner,{apply:(e,o,r)=>{return proxyJsonRpcSigner(e.bind(n)(...r),t)}});return new Proxy(n,{get:(n,e)=>"getSigner"===e?o:"signMessage"===e?o:"sendTransaction"===e?o:"connectUnchecked"===e?o:n[e]})}exports.proxyContract=proxyContract,exports.proxyWeb3Provider=proxyWeb3Provider;