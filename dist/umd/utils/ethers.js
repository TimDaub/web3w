var __awaiter=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))(function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function c(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,c)}s((o=o.apply(e,n||[])).next())})};!function(e){if("object"==typeof module&&"object"==typeof module.exports){var n=e(require,exports);void 0!==n&&(module.exports=n)}else"function"==typeof define&&define.amd&&define(["require","exports","./internals","named-logs"],e)}(function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.proxyWeb3Provider=n.proxyContract=void 0;const t=e("./internals"),o=e("named-logs").logs("web3w:ethers");function r(e,n,{onTxRequested:t,onTxCancelled:o,onTxSent:r,onSignatureRequested:i,onSignatureCancelled:a,onSignatureReceived:c}){n=Object.assign({sendTransaction:(n,i,a)=>__awaiter(this,void 0,void 0,function*(){const c=yield e.getAddress(),s=yield(yield e.getChainId()).toString(),d=Object.assign(Object.assign({},a[0]),{from:c,chainId:s});let u;t(d);try{u=yield n.bind(i)(...a)}catch(e){throw o(d),e}const f=(yield e.provider.getBlock("latest")).timestamp;return r(Object.assign(Object.assign({},u),{submissionBlockTime:f,chainId:s})),u}),signMessage:(n,t,o)=>__awaiter(this,void 0,void 0,function*(){const r=yield e.getAddress(),s={from:r,message:o[0]};let d;i(s);try{d=yield n.bind(t)(...o)}catch(e){throw a(s),e}return c({from:r,signature:d}),d})},n);const s={};return new Proxy(e,{get:(t,o)=>{const r=n[o];return r?function(n,t){let o=s[n];return o||(o=new Proxy(e[n],t),s[n]=o),o}(o,{apply:r}):t[o]}})}function i(e,n){return r(e,{connectUnchecked:(e,t,o)=>{return function(e,n){return r(e,{},n)}(e.bind(t)(...o),n)}},n)}n.proxyContract=function e(n,r,i,a){o.log("PROXY",{name:r});const c=a?Object.assign({onContractTxRequested:t.noop,onContractTxCancelled:t.noop,onContractTxSent:t.noop},a):{onContractTxRequested:t.noop,onContractTxCancelled:t.noop,onContractTxSent:t.noop},{onContractTxRequested:s,onContractTxCancelled:d,onContractTxSent:u}=c,f={},l=n.interface.fragments.filter(e=>"event"===e.type).map(e=>JSON.parse(e.format("json"))),g=n.interface.functions,p={};for(const e of Object.keys(g))p[g[e].name]=e;const m={};for(const e of Object.keys(n))m[e]=n[e];m.functions={};for(const e of Object.keys(n.functions))m.functions[e]=n.functions[e];function y(e,t){let o=f[t];if(!o){let a=n.interface.functions[t];a||(a=n.interface.functions[p[t]]),o=new Proxy(e[t],{apply:(o,c,f)=>__awaiter(this,void 0,void 0,function*(){const c=yield n.signer.getAddress(),g=f.length;let p,m,y,x=f;g===a.inputs.length+1&&"object"==typeof f[g-1]&&(x=x.slice(0,g-1),p=f[g]),p&&(m=p.metadata,delete(p=Object.assign({},p)).metadata),s({to:n.address,from:c,chainId:i,eventsABI:l,contractName:r,args:x,method:t,overrides:p,metadata:m});try{y=yield o.bind(e)(...f)}catch(e){throw d({to:n.address,from:c,chainId:i,eventsABI:l,contractName:r,args:x,method:t,overrides:p,metadata:m}),e}return u({hash:y.hash,to:n.address,from:c,chainId:i,eventsABI:l,contractName:r,args:x,method:t,overrides:p,metadata:m}),y})}),f[t]=o}return o}const x=new Proxy(m.functions,{get:(e,t)=>y(n.functions,t)});return new Proxy(m,{get:(t,o)=>"functions"===o?x:n.functions[o]?y(n.functions,o):"_proxiedContract"===o?n:"connect"===o?t=>e(n.connect(t),r,i,a):"toJSON"===o?()=>({address:n.address,abi:n.interface.fragments,functionsSignatures:n.interface.fragments.map(e=>e.format("full"))}):t[o]})},n.proxyWeb3Provider=function(e,n){const o=n?Object.assign({onTxRequested:t.noop,onTxCancelled:t.noop,onTxSent:t.noop,onSignatureRequested:t.noop,onSignatureCancelled:t.noop,onSignatureReceived:t.noop},n):{onTxRequested:t.noop,onTxCancelled:t.noop,onTxSent:t.noop,onSignatureRequested:t.noop,onSignatureCancelled:t.noop,onSignatureReceived:t.noop},r=new Proxy(e.getSigner,{apply:(n,t,r)=>i(n.bind(e)(...r),o)});return new Proxy(e,{get:(e,n)=>"getSigner"===n?r:e[n]})}});