var __awaiter=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))(function(r,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(i,c)}s((o=o.apply(e,n||[])).next())})};!function(e){if("object"==typeof module&&"object"==typeof module.exports){var n=e(require,exports);void 0!==n&&(module.exports=n)}else"function"==typeof define&&define.amd&&define(["require","exports","./internals","named-logs"],e)}(function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.proxyWeb3Provider=n.proxyContract=void 0;const t=e("./internals"),o=e("named-logs").logs("web3w:ethers");function r(e,n,{onTxRequested:t,onTxCancelled:o,onTxSent:r,onSignatureRequested:a,onSignatureCancelled:i,onSignatureReceived:c}){n=Object.assign({sendTransaction:(n,a,i)=>__awaiter(this,void 0,void 0,function*(){const c=yield e.getAddress(),s=yield(yield e.getChainId()).toString(),d=Object.assign(Object.assign({},i[0]),{from:c,chainId:s});let u;t(d);try{u=yield n.bind(a)(...i)}catch(e){throw o(d),e}const f=(yield e.provider.getBlock("latest")).timestamp;return r(Object.assign(Object.assign({},u),{submissionBlockTime:f,chainId:s})),u}),signMessage:(n,t,o)=>__awaiter(this,void 0,void 0,function*(){const r=yield e.getAddress(),s={from:r,message:o[0]};let d;a(s);try{d=yield n.bind(t)(...o)}catch(e){throw i(s),e}return c({from:r,signature:d}),d})},n);const s={};return new Proxy(e,{get:(t,o)=>{const r=n[o];return r?function(n,t){let o=s[n];return o||(o=new Proxy(e[n],t),s[n]=o),o}(o,{apply:r}):t[o]}})}function a(e,n){return r(e,{connectUnchecked:(e,t,o)=>{return function(e,n){return r(e,{},n)}(e.bind(t)(...o),n)}},n)}n.proxyContract=function e(n,r,a,i){o.log("PROXY",{name:r});const c=i?Object.assign({onContractTxRequested:t.noop,onContractTxCancelled:t.noop,onContractTxSent:t.noop},i):{onContractTxRequested:t.noop,onContractTxCancelled:t.noop,onContractTxSent:t.noop},{onContractTxRequested:s,onContractTxCancelled:d,onContractTxSent:u}=c,f={},l={},g=n.interface.fragments.filter(e=>"event"===e.type).map(e=>JSON.parse(e.format("json"))),p=n.interface.functions,m={};for(const e of Object.keys(p))m[p[e].name]=e;const y={};for(const e of Object.keys(n))y[e]=n[e];y.functions={};for(const e of Object.keys(n.functions))y.functions[e]=n.functions[e];function x(e,t,o){let i=e[o];if(!i){let c=n.interface.functions[o];c||(c=n.interface.functions[m[o]]),i=new Proxy(t[o],{apply:(e,i,f)=>__awaiter(this,void 0,void 0,function*(){const i=yield n.signer.getAddress(),l=f.length;let p,m,y,x=f;l===c.inputs.length+1&&"object"==typeof f[l-1]&&(x=x.slice(0,l-1),p=f[l]),p&&(m=p.metadata,delete(p=Object.assign({},p)).metadata),s({to:n.address,from:i,chainId:a,eventsABI:g,contractName:r,args:x,method:o,overrides:p,metadata:m});try{y=yield e.bind(t)(...f)}catch(e){throw d({to:n.address,from:i,chainId:a,eventsABI:g,contractName:r,args:x,method:o,overrides:p,metadata:m}),e}return u({hash:y.hash,to:n.address,from:i,chainId:a,eventsABI:g,contractName:r,args:x,method:o,overrides:p,metadata:m}),y})}),e[o]=i}return i}const h=new Proxy(y.functions,{get:(e,t)=>x(f,n.functions,t)});return new Proxy(y,{get:(t,o)=>"functions"===o?h:n.functions[o]?x(l,n,o):"_proxiedContract"===o?n:"connect"===o?t=>e(n.connect(t),r,a,i):"toJSON"===o?()=>({address:n.address,abi:n.interface.fragments,functionsSignatures:n.interface.fragments.map(e=>e.format("full"))}):t[o]})},n.proxyWeb3Provider=function(e,n){const o=n?Object.assign({onTxRequested:t.noop,onTxCancelled:t.noop,onTxSent:t.noop,onSignatureRequested:t.noop,onSignatureCancelled:t.noop,onSignatureReceived:t.noop},n):{onTxRequested:t.noop,onTxCancelled:t.noop,onTxSent:t.noop,onSignatureRequested:t.noop,onSignatureCancelled:t.noop,onSignatureReceived:t.noop},r=new Proxy(e.getSigner,{apply:(n,t,r)=>a(n.bind(e)(...r),o)});return new Proxy(e,{get:(e,n)=>"getSigner"===n?r:e[n]})}});