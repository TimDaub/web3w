var __awaiter=this&&this.__awaiter||function(n,e,o,t){return new(o||(o=Promise))(function(r,c){function i(n){try{s(t.next(n))}catch(n){c(n)}}function a(n){try{s(t.throw(n))}catch(n){c(n)}}function s(n){var e;n.done?r(n.value):(e=n.value,e instanceof o?e:new o(function(n){n(e)})).then(i,a)}s((t=t.apply(n,e||[])).next())})};import{noop}from"./internals";export function proxyContract(n,e,o){const t=o?Object.assign({onContractTxRequested:noop,onContractTxCancelled:noop,onContractTxSent:noop},o):{onContractTxRequested:noop,onContractTxCancelled:noop,onContractTxSent:noop},{onContractTxRequested:r,onContractTxCancelled:c,onContractTxSent:i}=t,a={},s=n.interface.functions,u={};for(const n of Object.keys(s))u[s[n].name]=n;const d={};for(const e of Object.keys(n))d[e]=n[e];d.functions={};for(const e of Object.keys(n.functions))d.functions[e]=n.functions[e];function p(o,t){let s=a[t];if(!s){let d=n.interface.functions[t];d||(d=n.interface.functions[u[t]]),s=new Proxy(o[t],{apply:(n,a,s)=>__awaiter(this,void 0,void 0,function*(){const a=s.length;let u,p,f;a===d.inputs.length+1&&"object"==typeof s[a-1]&&(u=s[a]),u&&(p=u.outcome,delete u.outcome),r({name:e,method:t,overrides:u,outcome:p});try{f=yield n.bind(o)(...s)}catch(n){throw c({name:e,method:t,overrides:u,outcome:p}),n}return i({hash:f.hash,name:e,method:t,overrides:u,outcome:p}),f})}),a[t]=s}return s}const f=new Proxy(d.functions,{get:(e,o)=>p(n.functions,o)});return new Proxy(d,{get:(e,o)=>"functions"===o?f:n.functions[o]?p(n.functions,o):"_proxiedContract"===o?n:"toJSON"===o?()=>({address:n.address,abi:n.interface.fragments}):e[o]})}function proxySigner(n,e,{onTxRequested:o,onTxCancelled:t,onTxSent:r,onSignatureRequested:c,onSignatureCancelled:i,onSignatureReceived:a}){e=Object.assign({sendTransaction:(n,e,c)=>__awaiter(this,void 0,void 0,function*(){let i;o(c[0]);try{i=yield n.bind(e)(...c)}catch(n){throw t(c[0]),n}return r(i),i}),signMessage:(n,e,o)=>__awaiter(this,void 0,void 0,function*(){let t;c(o[0]);try{t=yield n.bind(e)(...o)}catch(n){throw i(o[0]),n}return a(t),t})},e);const s={};return new Proxy(n,{get:(o,t)=>{const r=e[t];return r?function(e,o){let t=s[e];return t||(t=new Proxy(n[e],o),s[e]=t),t}(t,{apply:r}):o[t]}})}function proxyUncheckedJsonRpcSigner(n,e){return proxySigner(n,{},e)}function proxyJsonRpcSigner(n,e){return proxySigner(n,{connectUnchecked:(n,o,t)=>{return proxyUncheckedJsonRpcSigner(n.bind(o)(...t),e)}},e)}export function proxyWeb3Provider(n,e){const o=e?Object.assign({onTxRequested:noop,onTxCancelled:noop,onTxSent:noop,onSignatureRequested:noop,onSignatureCancelled:noop,onSignatureReceived:noop},e):{onTxRequested:noop,onTxCancelled:noop,onTxSent:noop,onSignatureRequested:noop,onSignatureCancelled:noop,onSignatureReceived:noop},t=new Proxy(n.getSigner,{apply:(e,t,r)=>{return proxyJsonRpcSigner(e.bind(n)(...r),o)}});return new Proxy(n,{get:(n,e)=>"getSigner"===e?t:"signMessage"===e?t:"sendTransaction"===e?t:"connectUnchecked"===e?t:n[e]})}